
define(['jquery', 'oae.core'], function($, oae) {

	return function(uid, showSettings, widgetData) {
		var $rootel = $('#' + uid);
		var init = function(){
			$.get("/api/meeting",function(data){
    				parsingData(data);
  			});		
		};

		var parsingData = function(data){
			
			for(var i=0;i<data.length;i++){
       				var obj = data[i];
				var div = document.createElement('div');
				var camera = document.createElement('div');
				var ul = document.createElement('ul');
				var li = document.createElement('li');
				var button = document.createElement('button');
				var plus = document.createElement('i');
				$(button).attr('type','button');
				$(button).attr('class','btn');
				
				$(camera).attr('class', 'camera-wrapper camera-wrapper-large icon-camera');
        			
				for(var key in obj){
            				var attrName = key;
            				var attrValue = obj[key];
					
					if(attrValue["value"]){
						if(attrValue["name"]=="id"){
							$(div).attr('id',attrValue["value"]);
							$(button).on('click',{meetingID : attrValue["value"]},createBBBCall);
						}
						if(attrValue["name"]=="displayName")
							$(button).append(attrValue["value"]);
					}
				}
				
				$(li).append(button);
				$(ul).append(li);
				$(camera).append(ul);
				$(div).append(camera);
				$('#meetings').append(div);
    			}
		};
	
		var createBBBCall = function(event){
			var meetingID = event.data.meetingID;
			console.log(meetingID);
			$.ajax({
				'type': "POST",
    				'url': '/api/create',
    				'data': {	
					meetingID : meetingID
			  	},
   				'success': function() { 
					alert('todo bien');
				},
   				'error': function() { alert('Meeting has not been created! :('); }
			});

		};

	init();
	};
	
})
