
define(['jquery', 'oae.core', 'oae.api'], function($, oae) {

	return function(uid, showSettings, widgetData) {
		var $rootel = $('#' + uid);
		
		var init = function(){
			$.get("/api/meeting",function(data){
    				parsingData(data);
  			});		
		};

		var parsingData = function(data){
			
			for(var i=0;i<data.length;i++){
       				var obj = data[i];
				var div = document.createElement('div');
				var camera = document.createElement('div');
				var button = document.createElement('button');
				var plus = document.createElement('i');
				$(button).attr('type','button');
				$(button).attr('class','btn');
				
				$(camera).attr('class', 'camera-wrapper camera-wrapper-large icon-camera');
        			
				for(var key in obj){
            				var attrName = key;
            				var attrValue = obj[key];
					
					if(attrValue["value"]){
						if(attrValue["name"]=="id"){
							$(div).attr('id',attrValue["value"]);
							$(button).on('click',{meetingID : attrValue["value"]},createBBBCall);
						}
						if(attrValue["name"]=="displayName")
							$(button).append(attrValue["value"]);
					}
				}
				
				$(camera).append(button);
				$(div).append(camera);
				$('#meetings').append(div);
    			}
		};
	
		var createBBBCall = function(event){
			var meetingID = event.data.meetingID;
			var displayName = oae.data.me.displayName;
			var name = displayName.split(' ')[0];
			$.ajax({
				'type': "POST",
    				'url': '/api/create',
    				'data': {	
					meetingID : meetingID,
					name : name
			  	},
   				'success': function(data) { 
					window.open(data);
				},
   				'error': function() { alert('Cannot join meeting'); }
			});
			

		};

	init();
	};
	
})